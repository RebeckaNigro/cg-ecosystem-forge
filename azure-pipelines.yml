# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  - main

resources:
  - repo: self

pool:
  name: rebecka_azure

- script: |
    pnpm install
    echo 'export const ID_SEM_INSTITUICAO=3' > .\src\utils\constantes.ts
    (Get-Content src\utils\http\index.ts) -replace 'https://hom-api\.ecossistemadeinovacaocg\.com\.br', $env:API_URL | Set-Content src\utils\http\index.ts
    pnpm build
    Copy-Item ./staticwebapp.config.json ./dist
    pnpx @azure/static-web-apps-cli deploy ./dist --env production
  shell: powershell
  env:
    SWA_CLI_DEPLOYMENT_TOKEN: $(DEPLOY_TOKEN)